# AreaSpells

**AreaSpells** позволяет создавать пользовательскиие заклинания, применяемые на область.

## Особенности

- Удобная настройка заклинаний;
- События входа и выхода в область заклинания с разнообразием передаваемых состояний;
- Динамическое управление характеристиками заклинаний;
- Учитывает коллизию юнитов;

## AddAreaSpellToUnit()

Добавляет заклинание с указанными характеристиками к юниту `dummyUnit`;

    call AddAreaSpellToUnit(unit ownerUnit, unit dummyUnit, integer actionsId, real duration, boolean pierceDeath, boolexpr filter, real rangeStart, real rangeEnd, real interval)

### Параметры функции

- `unit ownerUnit` - владелец заклинаний;
- `unit dummyUnit` - применяющий заклинание (может быть таким же как и  `unit ownerUnit`);
- `integer actionsId` - идентификатор действий заклинания;
- `real duration` - длительность заклинания;
- `boolean pierceDeath` - работает ли заклинание сквозь смерть `unit dummyUnit`;
- `boolexpr filter` - функция-фильтр;
- `real rangeStart` - начальный радиус области заклинания;
- `real rangeEnd` - конечный радиус области заклинания;
- `real interval` - интервал регистрации юнитов в области (>= 1/32.);

Для функции-фильтра можно использовать следующие геттеры:

- `GetSpellOwnerUnit() -> unit` - возвращает владельца заклинания;
- `GetSpellDummyUnit() -> unit` - возвращает применителя заклинания;
- `GetSpellCompletion() -> real` - процент завершение заклинания (0.0 - 1.0);

**Возвращаемое значение:**

Функция возвращает уникальный идентификатор созданного объекта, что позволяет сохранить его для того, чтобы получать доступ к объекту вручную, когда это нужно.

### Пример использования

    call AddAreaSpellToUnit(GetTriggerUnit(), GetTriggerUnit(), spell_tid, 3, false, Condition(function FilterSpell), real 100, real 300, 1/32.)  

1. Функция будет регистрировать вход и выход в область заклинания всех юнитов под фильтром `FilterSpell`.

2. Область заклинания равна 1 м. в начале действия и будет увеличиваться каждые 1/32. сек, пока не достигнет 3 м., после чего заклинание будет развеяно.

3. Каждое заклинание будет работать независимо друг от друга.

4. При входе и выходе юнита в область заклинания будет триггериться событие `TRIG_EVENT_AREA_SPELLS`. Для каждого юнита действия заклинания могут триггерится только один раз.

## Событие заклинаний

- [`TRIG_EVENT_SPELLS`](https://github.com/IlliaKorzhov/mars-addon/blob/master/engine/spells/SpellGetters.zn#L4) - Событие входа и выхода области заклинания любого юнита.
  - `GetTriggerSpell() -> AreaSpell` - возвращает заклинание в виде объекта `AreaSpell`;
  - `GetSpellOwnerUnit() -> unit` - возвращает владельца заклинания;
  - `GetSpellDummyUnit() -> unit` - возвращает применителя заклинания;
  - `GetSpellTargUnit() -> unit` - возвращает целевого юнита;
  - `GetSpellIsEntered() -> boolean` - целевой юнит вошел в область?;
  - `GetSpellIsOut() -> boolean` - целевой юнит вышел из области?;
  - `GetSpellActionsId() -> integer` - идентификатор действий события областных заклинаний;
  - `GetSpellCompletion() -> real` - процент завершение заклинания (0.0 - 1.0);

Чтобы ваш триггер обнаруживал это событие, нужно изменить имя события `TRIG_EVENT_SPELLS` на ваше имя тригера. Тоесть вы можете повесить только одно событие на один триггер.

Внутри триггера будут доступны следующие геттеры, указанные выше. Вне отслеживаемого триггера они будут возвращать нулевые значение.

Событие входа `GetSpellIsEntered()` триггерится один раз для каждого юнита.

События выхода `GetSpellIsOut()` триггерится один раз для каждого юнита.

## Список функций

- Прикрепляет эффект к заклинанию. Следующий вызов заменит эффект.  <br> `AttachEffectToAreaSpell(effect whichEffect, AreaSpell whichSpell)`
