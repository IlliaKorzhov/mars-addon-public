# Auras r. Oct 9

Гайд будет обновлен, когда перепишу бибилотеку.

**Auras** позволяет создавать кастомные ауры для юнитов.

## Возможнсти

- Динамически изменять любые параметры аур;
- Привязывать ауры к конкретным предметам или его типу;
- Удобное использование, которое совместимо с GUI;
- Полный доступ к объектам;
- Фильтрация юнитов;
- Управлять стакабельностью аур, которые излучает юнит;
- Управлять стакабельностью аур, которые действуют на юнита;
- Управлять взаимодействием аур разных типов;
- Устанавливать прироритет аур;
- Устанавливать окончательное время действия аур, которые уже не действуют на цель;

## AddAuraToUnit()

Функция `AddAuraToUnit()` добавляет ауру с указанными параметрами к юниту и возвращает уникальный идентификатор созданной ауры.

```lua
call AddAuraToUnit(auraUnit, typeId, itemAura, multiAurasToTarget, priority, multiAurasForOwner, refreshOutEnter, hardRefresh, actionsId, filter, radiusMax, endDuration, periodActions, period)
```

### Параметры функции

- `unit auraUnit` - юнит-владелец ауры;
- `integer typeId` - (опциональный) - тип ауры;
- `item itemAura` - (опциональный) - предмет, к которому привязывается созданная аура;
- `boolean multiAurasToTarget` - определяет, стакаются ли несколько аур с одинаковым типом на одну цель;
- `integer priority` - приоритет, если аура не стакается по целям;
- `boolean multiAurasForOwner` - определяет, стакаются ли несколько аур с одинаковым типом в инвентаре владельца;
- `boolean refreshOutEnter` - триггерить ли вход/выход при удалении ауры (триггерятся ауры с таким же типом);
- `boolean hardRefresh` - определяет, нужно ли множественно триггерить вход/выход из ауры;
- `integer actionsId` - идентификатор действий ауры, можно передать тот же typeId и использовать его;
- `boolexpr filter` (опциональный) - функция-фильтр целей для ауры;
- `real radiusMax` - радиус действия ауры;
- `real endDuration` - время действия ауры после того, как цель вышла за ее пределы;
- `boolean periodActions` - определяет, нужно ли запускать над целями периодические действия;
- `real period` - период действия на целями ауры;

**Возвращаемое значение:**

Функция возвращает уникальный идентификатор созданной ауры, что позволяет сохранить его для того, чтобы получать доступ к ауре вручную, когда это нужно.

### Пример использования

```lua
call AddAuraToUnit(GetTriggerUnit(), fire_tid, GetManipulatedItem(), true, 1, true, false, false, fire_tid, Condition(function FilterFire), 600., 1.5, true, 0.5)
```

  Данный код добавляет ауру с типом `fire_tid` к текущему юниту.

- Несколько аур стакаются в инвентаре;
- Действия аур стакается по целям;
- Действия аур имееют идентификатор `fire_tid`;
- Фильтрация целей - `Condition(function FilterFire)`;
- Радиус действия ауры 600;
- Действия над юнитами в ауре выполняются каждые 0.5 сек;
- Аура продолжает действовать на юнитов, которые вышли из её зоны действия еще 1.5 сек;

**Вход в зону действия ауры:**

Проверяется наличие действия других аур такого же типа, и если таких аур нет, то запускаются действия входа (`IsEnter`).

Если наличие действий другой ауры такого же типа присутсвует, то действие новой ауры будет добавлено, но без действий входа (`a. refreshOutEnter == false`).

**Выход из зоны действия ауры:**

Проверяется наличие действия других аур с таким же типом, и если таких аур нет, то запускаются действия выхода из ауры (`IsOut`).

Если наличие действий другой ауры такого же типа присутсвует, то действие исходной ауры будет удалено, но без действий выхода (`a. refreshOutEnter == false`).

### Описание работы параметров ауры

- `typeId`. Для каждой созданной ауры присваивается её тип (`typeId`). Если для юнита создается аура с таким же типом и указано, что она не стакается в инвентаре (`multiAurasForOwner == false`), то новая создаваемая аура заменит старую и будет работать только 1 аура. Если на цель хочет работать аура, но на эту цель уже работает другая аура с таким же типом и указано, что на цель ауры может работать только 1 аура (`multiAurasToTarget == false`), то эта аура не будет работать на цель.

- `itemAura` позволяет привязывать ауру к конкретному предмету, или типу предмета. Если указано, что аура стакается в инвентаре (`multiAurasForOwner == true`), то аура привязывется к конкретному предмету и при его потери будет удалена. Если указано, что аура не стакается в инвентаре (`multiAurasForOwner == false`), то аура привязывается к типу предмета, и если такого типа предмета не будет в инвентаре героя, то аура будет удалена.

- `filter` - функция-фильтр, необязательна, но желательна. Позволяет передать ауре фильтр для отсеивания ненужных юнитов. Фильтровать юнитов можно и в триггере-действии ауры, но с фильтром работает быстрее.

- `multiAurasToTarget` - на целей аур с одинаковым типом будет действовать только 1 такая аура. `true` - стакается по целям, `false` - не стакается по целям.

- `multiAurasForOwner` - будет ли создаваться несколько аур с одинаковым типом для одного юнита, или же заменятся старая. `true` - стакается в инвентаре, `false` - не стакается в инвентаре.

## Список функций

- Гуи-функция для создания ауры (аргументы передаются через глобальные переменные). <br> `AddAuraToUnitGUI() -> integer`

- Проверяет, действует ли на цель аура типа `typeId`. <br> `IsUnitTargetAddedTypeAura(unit u, integer typeId) -> boolean`

- Проверяет, излучает ли юнит ауру типа `typeId`. <br> `IsUnitOwnerAddedTypeAura(unit u, integer typeId) -> boolean`

- Удаляет все ауры которые излучает юнит типа `typeId`. Если аургмент `AllowMultiType == true`, то стакабельные ауры удалятся не будут. <br> `DestroyUnitAurasByType(unit u, integer typeId, boolean AllowMultiType)`

- Удаляет все ауры, которые излучает объект с `hashId`. <br> `DestroyAllAurasByHashId(integer hashId)`

- Возвращает владельца ауры типа `typeId`, которая действует на цель `u`. <br> `GetUnitOwnerForTargetAuraByType(unit u, integer typeId) -> unit`

- Возвращает ауру типа `typeId`, которую излучает юнит `u`. <br> `GetOwnerAuraByType(unit u, integer typeId) -> Aura`

- Возвращает ауру типа `typeId`, которая действует на юнита `u`. <br> `GetTargetAuraByType(unit u, integer typeId) -> Aura`